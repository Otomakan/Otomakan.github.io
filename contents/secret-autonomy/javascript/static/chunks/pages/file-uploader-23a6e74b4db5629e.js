(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[775],{6503:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/file-uploader",function(){return r(6734)}])},6734:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var i=r(5893),n=r(7294);let a=r(1953),{Parser:s}=r(5733),l=r(381),o={fields:["Site Location","Date / Time","Serial","NMI","kWh Generated (Register 2)","kWh AUX (Register 1)"]},u=async(e,t)=>{var r=new TextDecoder("utf-8");let i=await Promise.all(e.map(async e=>{let t=r.decode(e),i=await a.parseCSV(t),n=i[0];return n.time.substr(5,2),n.time.substr(8,2),i})),n=i.flat(),u=a.orderNEM12(n,{filterBy:{serial:t,register:["E1","1"]}}).sort((e,t)=>Number(new Date(e.time))-Number(new Date(t.time))),d=a.orderNEM12(n,{filterBy:{serial:t,register:["B1","2"]},orderBy:"time"}).sort((e,t)=>Number(new Date(e.time))-Number(new Date(t.time))),m={};d.forEach(e=>{Object.hasOwnProperty.call(m,e.time)||(m[e.time]={}),m[e.time][e.serial]=e});let h=d[0].time,f=d[d.length-1].time,p={};t.forEach(e=>{p[e]=c(d,"serial",e,l.utc(h),l.utc(f),1800)});try{let e=u.map(e=>m[e.time]&&m[e.time][e.serial]?{"Site Location":"On Luck Chinese Nursing Home","Date / Time":e.time,Serial:e.serial,NMI:e.nmi,"kWh Generated (Register 2)":m[e.time][e.serial].B,"kWh AUX (Register 1)":e.E}:{"Site Location":"On Luck Chinese Nursing Home","Date / Time":e.time,Serial:e.serial,NMI:e.nmi,"kWh Generated (Register 2)":0,"kWh AUX (Register 1)":e.E});console.log("formatted data");let r=new s(o),i=r.parse(e),n=[];t.map(e=>{n.push(...p[e].map(t=>({time:t,meter:e})))}).flat(),n.forEach(e=>{e.time=l.utc(e.time).format("YYYY-MM-DD")});let a=new Set,d=n.filter(e=>{let t=a.has(e.time+e.meter);return a.add(e.time+e.meter),!t}),c=window.URL.createObjectURL(new Blob([i])),h=new s({fields:["meter","time"]}),f=window.URL.createObjectURL(new Blob([h.parse(d)]));return{reportURL:c,missingData:f}}catch(e){console.error(e)}},d=(e,t,r)=>{let i=t.diff(e,"seconds")/r,n=[];for(let t=0;t<=i;t++)n.push(e.clone()),e.add(r,"seconds");return n},c=(e,t,r,i,n,a)=>{let s=d(i,n,a),o=0,u=[];return s.forEach(i=>{for(let n=o;n<e.length;n++){let a=e[n];if(a[t]!==r)continue;let s=l.utc(a.time),d=i.isSame(s);if(d)return{...a,time:s.toISOString()};let c=s.isAfter(i);if(c){u.push(i.toISOString());break}o+=1}return{[t]:r,interval:a,time:i.toISOString()}}),u},m=()=>{let[e,t]=(0,n.useState)([]),[r,a]=(0,n.useState)([]),[s,l]=(0,n.useState)(null),[o,d]=(0,n.useState)(null),[c,m]=(0,n.useState)(["SAM000025317","SAM000045209"]),h=async t=>{t.preventDefault();let{reportURL:r,missingData:i}=await u(e,c);l(r),d(i)},f=async i=>{let n=i.target.files,s=[],l=[];for(let e=0;e<n.length;e++){let t=n[e],r=await function(e){return new Promise((t,r)=>{let i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=r,i.readAsArrayBuffer(e)})}(t);l.push(t.name),s.push(r)}a([...r,...l]),t([...e,...s])};return(0,i.jsxs)("div",{children:[(0,i.jsxs)("form",{onSubmit:h,style:{width:"100%",padding:"50px"},children:[(0,i.jsx)("h1",{children:"React File Upload you can drop file in the ugly square"}),(0,i.jsxs)("h2",{children:["The target meters are : ",c.join(", ")]}),(0,i.jsx)("input",{multiple:!0,style:{paddingTop:"50px",border:"5px solid blue",width:"200px",height:"100px"},type:"file",onChange:f}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)("button",{type:"submit",children:"PROCESS  FILES"}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{children:r.map(e=>(0,i.jsx)("div",{children:e},e))})]}),s&&(0,i.jsx)("h2",{style:{padding:"50px"},children:(0,i.jsx)("a",{href:s,download:"report.csv",children:"Download Report"})}),o&&(0,i.jsx)("h2",{style:{padding:"50px"},children:(0,i.jsx)("a",{href:o,download:"missingData.csv",children:"Download Missing Data"})})]})};var h=m}},function(e){e.O(0,[678,885,497,953,774,888,179],function(){return e(e.s=6503)}),_N_E=e.O()}]);