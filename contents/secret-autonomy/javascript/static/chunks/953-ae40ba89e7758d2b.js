(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[953],{3179:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeDuplicateFromOrderedTimeseries=t.removeDuplicateTimeseries=t.mergeTimeseriesValues=t.filterTarget=t.filterRegisters=t.filterSerials=t.filterNMIs=t.filterTSUnits=t.filterTimeseries=void 0;let r=(e,r)=>{let n=r.nmi?r.nmi:[];if(!Array.isArray(n))throw Error("Nmi targets should be an array");let i=r.serial?r.serial:[];if(!Array.isArray(i))throw Error("Nmi targets should be an array");let s=r.register?r.register:[];if(!Array.isArray(s))throw Error("Nmi targets should be an array");let o=r.units?r.units:["E","B","K","Q"];if(!Array.isArray(o))throw Error("Nmi targets should be an array");let a=t.filterTSUnits(t.filterNMIs(t.filterSerials(t.filterRegisters(e,s),i),n),o);return a};t.filterTimeseries=r;let n=(e,t)=>e.filter(e=>{for(let r=0;r<t.length;r++)if(Object.hasOwnProperty.call(e,t[r]))return!0;return!1});t.filterTSUnits=n;let i=(e,r)=>t.filterTarget(e,"nmi",r);t.filterNMIs=i;let s=(e,r)=>t.filterTarget(e,"serial",r);t.filterSerials=s;let o=(e,r)=>t.filterTarget(e,"register",r);t.filterRegisters=o;let a=(e,t,r)=>{if(0===r.length)return e;let n=e=>!(r.length>0)||!!r.includes(e[t]);return e.filter(n)};t.filterTarget=a;let u=(e,t)=>({E:(e.E||0)+(t.E||0),B:(e.B||0)+(t.B||0),K:(e.K||0)+(t.K||0),Q:(e.Q||0)+(t.Q||0)});t.mergeTimeseriesValues=u;let l=e=>e.filter((e,t,r)=>t===r.findIndex(t=>t.time===e.time&&t.nmi===e.nmi&&t.serial===e.serial&&t.register===e.register));t.removeDuplicateTimeseries=l;let f=e=>e.filter((e,t,r)=>{if(r[t+1]){let e=(t,n)=>{let i=r[n];if(r[n+1])return(t.time!==i.time||t.nmi!==i.nmi||t.serial!==i.serial||t.register!==i.register)&&(t.time!==i.time||e(t,n+1))};return e(r[t],t+1)}});t.removeDuplicateFromOrderedTimeseries=f},2011:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.groupByInterval=t.groupByNMIs=t.groupBySerials=t.groupByRegisters=void 0;let i=r(1278);n(r(8));let s=e=>{let t={};return e.forEach(e=>{let r=e.nmi+e.register+e.serial+e.time;if(!Object.hasOwnProperty.call(t,r)){t[r]=e;return}t[r]={...t[r],...e,...u(t[r],e)}}),Object.values(t)};t.groupByRegisters=s;let o=e=>{let t={};return e.forEach(e=>{let r=e.nmi+e.serial+e.time;if(!Object.hasOwnProperty.call(t,r)){t[r]=e;return}t[r]={...t[r],...e,...u(t[r],e)}}),Object.values(t)};t.groupBySerials=o;let a=e=>{let t={};return e.forEach(e=>{let r=e.nmi+e.time;if(!Object.hasOwnProperty.call(t,r)){t[r]=e;return}t[r]={...t[r],...e,...u(t[r],e)}}),Object.values(t)};t.groupByNMIs=a;let u=(e,t)=>({E:(e.E||0)+(t.E||0),B:(e.B||0)+(t.B||0),K:(e.K||0)+(t.K||0),Q:(e.Q||0)+(t.Q||0)}),l=(e,t)=>{if(0===e.length)return[];let r=i.orderByTime(e);return r};t.groupByInterval=l},1953:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.orderNEM12=t.parseCSV=void 0;let o=s(r(5806)),a=s(r(1278));t.parseCSV=o.parseCSV,t.orderNEM12=a.orderNem12},1278:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.orderByTime=t.orderNem12=void 0;let n=r(2011),i=r(3179),s=(e,t)=>{let r=t.groupBy,s=t.interval||60,o=t.allowDuplicates||!1,a=t.filterBy||{},u=n.groupByInterval(i.filterTimeseries(e,a),s);if(o||(u=i.removeDuplicateFromOrderedTimeseries(u)),!r||0===Object.keys(r).length)return u;if("register"===r){let t=n.groupByRegisters(e);return t}if("serial"===r){let t=n.groupBySerials(e);return t}let l=n.groupByNMIs(u);return l};t.orderNem12=s;let o=e=>e.sort((e,t)=>Number(new Date(e.time))-Number(new Date(t.time)));t.orderByTime=o},5806:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.csvNEM12Parser=t.parseCSV=void 0;let i=r(6549),s=n(r(8)),o=r(338),a=e=>{let t=[],r=null;return e.forEach(e=>{"200"===e[0]&&(r=e),"300"===e[0]&&t.push([r,e])}),t},u=async e=>{let r=await o.csvToArrays(e),n=t.csvNEM12Parser(r);return n};t.parseCSV=u;let l=e=>{let t=a(e),r=t.map(e=>h(e)),n=f(r.flat());return n};t.csvNEM12Parser=l;let f=e=>{let t={};return e.forEach(e=>{let r=e.nmi+e.register+e.serial+e.time;if(!Object.hasOwnProperty.call(t,r)){t[r]=e;return}t[r]={...t[r],...e}}),Object.values(t)},h=e=>{let t=e[0],r=e[1],n=i.getColUpper(t,1),o=i.getColUpper(t,3),a=i.getColInt(t,8),u=i.getColUpper(t,6),l=i.getColUpper(t,4);2!==l.length&&2===i.getColUpper(t,3).length&&(l=i.getColUpper(t,3)),2!==l.length&&2===i.getColUpper(t,3).length&&(l=i.getColUpper(t,3));let f=l.substr(0,1),h=i.getColUpper(t,7),d=1;switch(h){case"MWH":case"MVARH":d=1e-6;break;case"WH":case"VARH":default:d=1;break;case"KWH":case"KVARH":d=1e3}let p=s.default(i.getColUpper(r,1)),m=c(r,p,a,d),g=m.map(e=>({nmi:n,serial:u,time:e.time,register:o,[f]:e.value,interval:a}));return g},c=(e,t,r,n)=>{let i=[],s=1440/r,o=t.startOf("day");for(let t=2;t<s+2;t++){let s=Number(e[t]);if(Number.isNaN(s))throw Error(`Row 300 contains a value that is not a number : ${e}`);i.push({value:s*n,time:o.format("YYYY-MM-DDTHH:mm:ss")}),o.add(r,"minutes")}return i}},338:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.csvToArrays=void 0;let i=n(r(7460));i.default.parsePromise=function(e){return new Promise(function(t,r){i.default.parse(e,{complete:t,error:r})})};let s=async e=>{let t=e.toString(),r=await i.default.parsePromise(t,{delimiter:",",newline:"\n",header:!1,dynamicTyping:!1,preview:0,encoding:"",worker:!1,comments:!1,step:void 0,error:void 0,download:!1,skipEmptyLines:!0,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0});!function(e){if(null!==e&&null!==e.length&&0!==e.length)for(let t=0,r=e.length;t<r;t++)e[t][0].startsWith("\n")&&(e[t][0]=e[t][0].substr(1)),e[t][0].startsWith("\r")&&(e[t][0]=e[t][0].substr(1))}(r.data);let n=function(e){if(null===e||null===e.length||0===e.length||null===e[0]||null===e[0].length||0===e[0].length)return"Invalid";let t=e[0].join().toUpperCase();return(t.startsWith("\n")&&(t=t.substring(1)),t.startsWith("\r")&&(t=t.substring(1)),t.startsWith("NMI,METER SERIAL NUMBER,CON/GEN,DATE,ESTIMATED?"))?"powershop":t.startsWith("ACCOUNTNUMBER,NMI,DEVICENUMBER,DEVICETYPE,REGISTERCODE,RATETYPEDESCRIPTION,STARTDATE,ENDDATE,PROFILEREADVALUE,REGISTERREADVALUE,QUALITYFLAG")?"AGL":t.startsWith("NMI,DATE,TIME,KWH")?"sapn":t.startsWith("NMI,METERSERIAL,PERIOD,LOCAL TIME,E")?"ERM":t.startsWith("METER TYPE,READ DATE AND TIME,READ VALUE (KWH)")?"AUSNET":"100"===e[0][0]||"200"===e[0][0]||"900"===e[0][0]?"NEM12":"invalid"}(r.data);if("NEM12"!==n)throw Error(`The file ${r.name} is not a NEM12 file`);return r.data};t.csvToArrays=s},6549:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getNextRow=t.IsNullOrWhiteSpace=t.roundNumber=t.formatMoney=t.getColDate=t.getColDate_yyyyMMdd=t.getColFloat=t.getColInt=t.getColUpper=void 0;let i=n(r(8)),s=(e,t)=>{if(null===e||e.length<=t)return"";let r=e[t];return c(r)?"":r.trim().toUpperCase()};t.getColUpper=s;let o=(e,t)=>{if(null===e||e.length<=t)return 0;let r=parseInt(e[t]);return isNaN(r)&&(r=0),r};t.getColInt=o;let a=(e,t)=>{if(null===e||e.length<=t)return 0;let r=parseFloat(e[t]);return isNaN(r)&&(r=0),r};t.getColFloat=a;let u=(e,t)=>{if(null===e||e.length<=t)return new Date;let r=e[t];if(c(r)||!/^(\d){8}$/.test(r))return new Date;let n=r.substr(0,4),i=r.substr(4,2),s=r.substr(6,2);return new Date(n+"-"+i+"-"+s)};t.getColDate_yyyyMMdd=u;let l=(e,t,r)=>{if(null===e||e.length<=t)return new Date;let n=e[t];if(c(n))return new Date;let s=i.default(n,r);return s.isValid()?s.toDate():new Date};t.getColDate=l;let f=(e,t,r,n)=>{t=isNaN(t=Math.abs(t))?2:t,n=void 0===n?".":n,r=void 0===r?",":r;let i=parseInt(Math.abs(+e||0).toFixed(t))+"",s=i.length>3?i.length%3:0;return(e<0?"-":"")+(s?i.substr(0,s)+r:"")+i.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+r)+(t?n+Math.abs(Number(e)-Number(i)).toFixed(t).slice(2):"")};t.formatMoney=f;let h=(e,t)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);function c(e){return null==e||e.replace(/\s/g,"").length<1}t.roundNumber=h,t.IsNullOrWhiteSpace=c;let d=(e,t)=>t[e+1];t.getNextRow=d},8:function(e,t,r){(e.exports=r(5177)).tz.load(r(1128))},5177:function(e,t,r){var n,i,s;s=function(e){"use strict";void 0===e.version&&e.default&&(e=e.default);var t,r,n={},i={},s={},o={},a={};e&&"string"==typeof e.version||T("Moment Timezone requires Moment.js. See https://momentjs.com/timezone/docs/#/use-it/browser/");var u=e.version.split("."),l=+u[0],f=+u[1];function h(e){return e>96?e-87:e>64?e-29:e-48}function c(e){var t,r=0,n=e.split("."),i=n[0],s=n[1]||"",o=1,a=0,u=1;for(45===e.charCodeAt(0)&&(r=1,u=-1);r<i.length;r++)a=60*a+(t=h(i.charCodeAt(r)));for(r=0;r<s.length;r++)o/=60,a+=(t=h(s.charCodeAt(r)))*o;return a*u}function d(e){for(var t=0;t<e.length;t++)e[t]=c(e[t])}function p(e,t){var r,n=[];for(r=0;r<t.length;r++)n[r]=e[t[r]];return n}function m(e){var t=e.split("|"),r=t[2].split(" "),n=t[3].split(""),i=t[4].split(" ");return d(r),d(n),d(i),function(e,t){for(var r=0;r<t;r++)e[r]=Math.round((e[r-1]||0)+6e4*e[r]);e[t-1]=1/0}(i,n.length),{name:t[0],abbrs:p(t[1].split(" "),n),offsets:p(r,n),untils:i,population:0|t[5]}}function g(e){e&&this._set(m(e))}function _(e,t){this.name=e,this.zones=t}function v(e){var t=e.toTimeString(),r=t.match(/\([a-z ]+\)/i);"GMT"===(r=r&&r[0]?(r=r[0].match(/[A-Z]/g))?r.join(""):void 0:(r=t.match(/[A-Z]{3,5}/g))?r[0]:void 0)&&(r=void 0),this.at=+e,this.abbr=r,this.offset=e.getTimezoneOffset()}function y(e){this.zone=e,this.offsetScore=0,this.abbrScore=0}function b(e,t){return e.offsetScore!==t.offsetScore?e.offsetScore-t.offsetScore:e.abbrScore!==t.abbrScore?e.abbrScore-t.abbrScore:e.zone.population!==t.zone.population?t.zone.population-e.zone.population:t.zone.name.localeCompare(e.zone.name)}function E(e){return(e||"").toLowerCase().replace(/\//g,"_")}function w(e){var t,r,i,s;for("string"==typeof e&&(e=[e]),t=0;t<e.length;t++)n[s=E(r=(i=e[t].split("|"))[0])]=e[t],o[s]=r,function(e,t){var r,n;for(d(t),r=0;r<t.length;r++)a[n=t[r]]=a[n]||{},a[n][e]=!0}(s,i[2].split(" "))}function k(e,t){var r,s=n[e=E(e)];return s instanceof g?s:"string"==typeof s?(s=new g(s),n[e]=s,s):i[e]&&t!==k&&(r=k(i[e],k))?((s=n[e]=new g)._set(r),s.name=o[e],s):null}function O(e){var t,r,n,s;for("string"==typeof e&&(e=[e]),t=0;t<e.length;t++)n=E((r=e[t].split("|"))[0]),s=E(r[1]),i[n]=s,o[n]=r[0],i[s]=n,o[s]=r[1]}function C(e){return C.didShowError||(C.didShowError=!0,T("moment.tz.zoneExists('"+e+"') has been deprecated in favor of !moment.tz.zone('"+e+"')")),!!k(e)}function R(e){var t="X"===e._f||"x"===e._f;return!!(e._a&&void 0===e._tzm&&!t)}function T(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}function S(t){var r=Array.prototype.slice.call(arguments,0,-1),n=arguments[arguments.length-1],i=k(n),s=e.utc.apply(null,r);return i&&!e.isMoment(t)&&R(s)&&s.add(i.parse(s),"minutes"),s.tz(n),s}(l<2||2===l&&f<6)&&T("Moment Timezone requires Moment.js >= 2.6.0. You are using Moment.js "+e.version+". See momentjs.com"),g.prototype={_set:function(e){this.name=e.name,this.abbrs=e.abbrs,this.untils=e.untils,this.offsets=e.offsets,this.population=e.population},_index:function(e){var t,r=+e,n=this.untils;for(t=0;t<n.length;t++)if(r<n[t])return t},countries:function(){var e=this.name;return Object.keys(s).filter(function(t){return -1!==s[t].zones.indexOf(e)})},parse:function(e){var t,r,n,i,s=+e,o=this.offsets,a=this.untils,u=a.length-1;for(i=0;i<u;i++)if(t=o[i],r=o[i+1],n=o[i?i-1:i],t<r&&S.moveAmbiguousForward?t=r:t>n&&S.moveInvalidForward&&(t=n),s<a[i]-6e4*t)return o[i];return o[u]},abbr:function(e){return this.abbrs[this._index(e)]},offset:function(e){return T("zone.offset has been deprecated in favor of zone.utcOffset"),this.offsets[this._index(e)]},utcOffset:function(e){return this.offsets[this._index(e)]}},y.prototype.scoreOffsetAt=function(e){this.offsetScore+=Math.abs(this.zone.utcOffset(e.at)-e.offset),this.zone.abbr(e.at).replace(/[^A-Z]/g,"")!==e.abbr&&this.abbrScore++},S.version="0.5.31",S.dataVersion="",S._zones=n,S._links=i,S._names=o,S._countries=s,S.add=w,S.link=O,S.load=function(e){w(e.zones),O(e.links),function(e){var t,r,n,i;if(e&&e.length)for(t=0;t<e.length;t++)r=(i=e[t].split("|"))[0].toUpperCase(),n=i[1].split(" "),s[r]=new _(r,n)}(e.countries),S.dataVersion=e.version},S.zone=k,S.zoneExists=C,S.guess=function(e){return(!r||e)&&(r=function(){try{var e=Intl.DateTimeFormat().resolvedOptions().timeZone;if(e&&e.length>3){var t=o[E(e)];if(t)return t;T("Moment Timezone found "+e+" from the Intl api, but did not have that data loaded.")}}catch(e){}var r,n,i,s=function(){var e,t,r,n=new Date().getFullYear()-2,i=new v(new Date(n,0,1)),s=[i];for(r=1;r<48;r++)(t=new v(new Date(n,r,1))).offset!==i.offset&&(s.push(e=function(e,t){for(var r,n;n=((t.at-e.at)/12e4|0)*6e4;)(r=new v(new Date(e.at+n))).offset===e.offset?e=r:t=r;return e}(i,t)),s.push(new v(new Date(e.at+6e4)))),i=t;for(r=0;r<4;r++)s.push(new v(new Date(n+r,0,1))),s.push(new v(new Date(n+r,6,1)));return s}(),u=s.length,l=function(e){var t,r,n,i=e.length,s={},u=[];for(t=0;t<i;t++)for(r in n=a[e[t].offset]||{})n.hasOwnProperty(r)&&(s[r]=!0);for(t in s)s.hasOwnProperty(t)&&u.push(o[t]);return u}(s),f=[];for(n=0;n<l.length;n++){for(i=0,r=new y(k(l[n]),u);i<u;i++)r.scoreOffsetAt(s[i]);f.push(r)}return f.sort(b),f.length>0?f[0].zone.name:void 0}()),r},S.names=function(){var e,t=[];for(e in o)o.hasOwnProperty(e)&&(n[e]||n[i[e]])&&o[e]&&t.push(o[e]);return t.sort()},S.Zone=g,S.unpack=m,S.unpackBase60=c,S.needsOffset=R,S.moveInvalidForward=!0,S.moveAmbiguousForward=!1,S.countries=function(){return Object.keys(s)},S.zonesForCountry=function(e,t){if(!(e=s[e.toUpperCase()]||null))return null;var r=e.zones.sort();return t?r.map(function(e){var t=k(e);return{name:e,offset:t.utcOffset(new Date)}}):r};var M=e.fn;function D(e){return function(){return this._z?this._z.abbr(this):e.call(this)}}function A(e){return function(){return this._z=null,e.apply(this,arguments)}}e.tz=S,e.defaultZone=null,e.updateOffset=function(t,r){var n,i=e.defaultZone;if(void 0===t._z&&(i&&R(t)&&!t._isUTC&&(t._d=e.utc(t._a)._d,t.utc().add(i.parse(t),"minutes")),t._z=i),t._z){if(16>Math.abs(n=t._z.utcOffset(t))&&(n/=60),void 0!==t.utcOffset){var s=t._z;t.utcOffset(-n,r),t._z=s}else t.zone(n,r)}},M.tz=function(t,r){if(t){if("string"!=typeof t)throw Error("Time zone name must be a string, got "+t+" ["+typeof t+"]");return this._z=k(t),this._z?e.updateOffset(this,r):T("Moment Timezone has no data for "+t+". See http://momentjs.com/timezone/docs/#/data-loading/."),this}if(this._z)return this._z.name},M.zoneName=D(M.zoneName),M.zoneAbbr=D(M.zoneAbbr),M.utc=A(M.utc),M.local=A(M.local),M.utcOffset=(t=M.utcOffset,function(){return arguments.length>0&&(this._z=null),t.apply(this,arguments)}),e.tz.setDefault=function(t){return(l<2||2===l&&f<9)&&T("Moment Timezone setDefault() requires Moment.js >= 2.9.0. You are using Moment.js "+e.version+"."),e.defaultZone=t?k(t):null,e};var z=e.momentProperties;return"[object Array]"===Object.prototype.toString.call(z)?(z.push("_z"),z.push("_a")):z&&(z._z=null),e},e.exports?e.exports=s(r(381)):(n=[r(381)],void 0===(i=s.apply(t,n))||(e.exports=i))},7460:function(e,t){var r,n;void 0!==(r="function"==typeof(n=function e(){"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},r=!t.document&&!!t.postMessage,n=r&&/blob:/i.test((t.location||{}).protocol),i={},s=0,o={parse:function(r,n){var a=(n=n||{}).dynamicTyping||!1;if(E(a)&&(n.dynamicTypingFunction=a,a={}),n.dynamicTyping=a,n.transform=!!E(n.transform)&&n.transform,n.worker&&o.WORKERS_SUPPORTED){var u=function(){if(!o.WORKERS_SUPPORTED)return!1;var r,n,a=(r=t.URL||t.webkitURL||null,n=e.toString(),o.BLOB_URL||(o.BLOB_URL=r.createObjectURL(new Blob(["(",n,")();"],{type:"text/javascript"})))),u=new t.Worker(a);return u.onmessage=g,u.id=s++,i[u.id]=u}();return u.userStep=n.step,u.userChunk=n.chunk,u.userComplete=n.complete,u.userError=n.error,n.step=E(n.step),n.chunk=E(n.chunk),n.complete=E(n.complete),n.error=E(n.error),delete n.worker,void u.postMessage({input:r,config:n,workerId:u.id})}var d=null;return o.NODE_STREAM_INPUT,"string"==typeof r?d=n.download?new l(n):new h(n):!0===r.readable&&E(r.read)&&E(r.on)?d=new c(n):(t.File&&r instanceof File||r instanceof Object)&&(d=new f(n)),d.stream(r)},unparse:function(e,t){var r=!1,n=!0,i=",",s="\r\n",a='"',u=a+a,l=!1,f=null,h=!1;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter(function(e){return -1!==t.delimiter.indexOf(e)}).length||(i=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(s=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(n=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw Error("Option columns is empty");f=t.columns}void 0!==t.escapeChar&&(u=t.escapeChar+a),("boolean"==typeof t.escapeFormulae||t.escapeFormulae instanceof RegExp)&&(h=t.escapeFormulae instanceof RegExp?t.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var c=RegExp(p(a),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return d(null,e,l);if("object"==typeof e[0])return d(f||Object.keys(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||f),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),d(e.fields||[],e.data||[],l);throw Error("Unable to serialize unrecognized input");function d(e,t,r){var o="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var a=Array.isArray(e)&&0<e.length,u=!Array.isArray(t[0]);if(a&&n){for(var l=0;l<e.length;l++)0<l&&(o+=i),o+=m(e[l],l);0<t.length&&(o+=s)}for(var f=0;f<t.length;f++){var h=a?e.length:t[f].length,c=!1,d=a?0===Object.keys(t[f]).length:0===t[f].length;if(r&&!a&&(c="greedy"===r?""===t[f].join("").trim():1===t[f].length&&0===t[f][0].length),"greedy"===r&&a){for(var p=[],g=0;g<h;g++){var _=u?e[g]:g;p.push(t[f][_])}c=""===p.join("").trim()}if(!c){for(var v=0;v<h;v++){0<v&&!d&&(o+=i);var y=a&&u?e[v]:v;o+=m(t[f][y],v)}f<t.length-1&&(!r||0<h&&!d)&&(o+=s)}}return o}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var n=!1;h&&"string"==typeof e&&h.test(e)&&(e="'"+e,n=!0);var s=e.toString().replace(c,u);return(n=n||!0===r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1}(s,o.BAD_DELIMITERS)||-1<s.indexOf(i)||" "===s.charAt(0)||" "===s.charAt(s.length-1))?a+s+a:s}}};if(o.RECORD_SEP="\x1e",o.UNIT_SEP="\x1f",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r","\n",'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!r&&!!t.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=m,o.ParserHandle=d,o.NetworkStreamer=l,o.FileStreamer=f,o.StringStreamer=h,o.ReadableStreamStreamer=c,t.jQuery){var a=t.jQuery;a.fn.parse=function(e){var r=e.config||{},n=[];return this.each(function(e){if(!("INPUT"===a(this).prop("tagName").toUpperCase()&&"file"===a(this).attr("type").toLowerCase()&&t.FileReader)||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)n.push({file:this.files[i],inputElem:this,instanceConfig:a.extend({},r)})}),i(),this;function i(){if(0!==n.length){var t,r,i,u=n[0];if(E(e.before)){var l=e.before(u.file,u.inputElem);if("object"==typeof l){if("abort"===l.action)return t=u.file,r=u.inputElem,i=l.reason,void(E(e.error)&&e.error({name:"AbortError"},t,r,i));if("skip"===l.action)return void s();"object"==typeof l.config&&(u.instanceConfig=a.extend(u.instanceConfig,l.config))}else if("skip"===l)return void s()}var f=u.instanceConfig.complete;u.instanceConfig.complete=function(e){E(f)&&f(e,u.file,u.inputElem),s()},o.parse(u.file,u.instanceConfig)}else E(e.complete)&&e.complete()}function s(){n.splice(0,1),i()}}}function u(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(e){var t=y(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new d(t),(this._handle.streamer=this)._config=t}).call(this,e),this.parseChunk=function(e,r){if(this.isFirstChunk&&E(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);void 0!==i&&(e=i)}this.isFirstChunk=!1,this._halted=!1;var s=this._partialLine+e;this._partialLine="";var a=this._handle.parse(s,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var u=a.meta.cursor;this._finished||(this._partialLine=s.substring(u-this._baseIndex),this._baseIndex=u),a&&a.data&&(this._rowCount+=a.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)t.postMessage({results:a,workerId:o.WORKER_ID,finished:l});else if(E(this._config.chunk)&&!r){if(this._config.chunk(a,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);a=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(a.data),this._completeResults.errors=this._completeResults.errors.concat(a.errors),this._completeResults.meta=a.meta),this._completed||!l||!E(this._config.complete)||a&&a.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||a&&a.meta.paused||this._nextChunk(),a}this._halted=!0},this._sendError=function(e){E(this._config.error)?this._config.error(e):n&&this._config.error&&t.postMessage({workerId:o.WORKER_ID,error:e,finished:!1})}}function l(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),u.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+i)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){var e;4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null===(e=t.getResponseHeader("Content-Range"))?-1:parseInt(e.substring(e.lastIndexOf("/")+1))),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(Error(r))}}function f(e){(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),u.call(this,e);var t,r,n="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,n?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,i)}var s=t.readAsText(e,this._config.encoding);n||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function h(e){var t;u.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,r=this._config.chunkSize;return r?(e=t.substring(0,r),t=t.substring(r)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function c(e){u.call(this,e=e||{});var t=[],r=!0,n=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=b(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=b(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=b(function(){this._streamCleanUp(),n=!0,this._streamData("")},this),this._streamCleanUp=b(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function d(e){var t,r,n,i=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,s=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,a=this,u=0,l=0,f=!1,h=!1,c=[],d={data:[],errors:[],meta:{}};if(E(e.step)){var g=e.step;e.step=function(t){if(d=t,b())v();else{if(v(),0===d.data.length)return;u+=t.data.length,e.preview&&u>e.preview?r.abort():(d.data=d.data[0],g(d,a))}}}function _(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function v(){return d&&n&&(w("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines&&(d.data=d.data.filter(function(e){return!_(e)})),b()&&function(){if(d){if(Array.isArray(d.data[0])){for(var t=0;b()&&t<d.data.length;t++)d.data[t].forEach(r);d.data.splice(0,1)}else d.data.forEach(r)}function r(t,r){E(e.transformHeader)&&(t=e.transformHeader(t,r)),c.push(t)}}(),function(){if(!d||!e.header&&!e.dynamicTyping&&!e.transform)return d;function t(t,r){var n,o=e.header?{}:[];for(n=0;n<t.length;n++){var a,u,f=n,h=t[n];e.header&&(f=n>=c.length?"__parsed_extra":c[n]),e.transform&&(h=e.transform(h,f)),a=f,u=h,e.dynamicTypingFunction&&void 0===e.dynamicTyping[a]&&(e.dynamicTyping[a]=e.dynamicTypingFunction(a)),h=!0===(e.dynamicTyping[a]||e.dynamicTyping)?"true"===u||"TRUE"===u||"false"!==u&&"FALSE"!==u&&(!function(e){if(i.test(e)){var t=parseFloat(e);if(-9007199254740992<t&&t<9007199254740992)return!0}return!1}(u)?s.test(u)?new Date(u):""===u?null:u:parseFloat(u)):u,"__parsed_extra"===f?(o[f]=o[f]||[],o[f].push(h)):o[f]=h}return e.header&&(n>c.length?w("FieldMismatch","TooManyFields","Too many fields: expected "+c.length+" fields but parsed "+n,l+r):n<c.length&&w("FieldMismatch","TooFewFields","Too few fields: expected "+c.length+" fields but parsed "+n,l+r)),o}var r=1;return!d.data.length||Array.isArray(d.data[0])?(d.data=d.data.map(t),r=d.data.length):d.data=t(d.data,0),e.header&&d.meta&&(d.meta.fields=c),l+=r,d}()}function b(){return e.header&&0===c.length}function w(e,t,r,n){var i={type:e,code:t,message:r};void 0!==n&&(i.row=n),d.errors.push(i)}this.parse=function(i,s,a){var u=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var r=RegExp(p(t)+"([^]*?)"+p(t),"gm"),n=(e=e.replace(r,"")).split("\r"),i=e.split("\n"),s=1<i.length&&i[0].length<n[0].length;if(1===n.length||s)return"\n";for(var o=0,a=0;a<n.length;a++)"\n"===n[a][0]&&o++;return o>=n.length/2?"\r\n":"\r"}(i,u)),n=!1,e.delimiter)E(e.delimiter)&&(e.delimiter=e.delimiter(i),d.meta.delimiter=e.delimiter);else{var l=function(t,r,n,i,s){var a,u,l,f;s=s||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var h=0;h<s.length;h++){var c=s[h],d=0,p=0,g=0;l=void 0;for(var v=new m({comments:i,delimiter:c,newline:r,preview:10}).parse(t),y=0;y<v.data.length;y++)if(n&&_(v.data[y]))g++;else{var b=v.data[y].length;p+=b,void 0!==l?0<b&&(d+=Math.abs(b-l),l=b):l=b}0<v.data.length&&(p/=v.data.length-g),(void 0===u||d<=u)&&(void 0===f||f<p)&&1.99<p&&(u=d,a=c,f=p)}return{successful:!!(e.delimiter=a),bestDelimiter:a}}(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);l.successful?e.delimiter=l.bestDelimiter:(n=!0,e.delimiter=o.DefaultDelimiter),d.meta.delimiter=e.delimiter}var h=y(e);return e.preview&&e.header&&h.preview++,t=i,d=(r=new m(h)).parse(t,s,a),v(),f?{meta:{paused:!0}}:d||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,r.abort(),t=E(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){a.streamer._halted?(f=!1,a.streamer.parseChunk(t,!0)):setTimeout(a.resume,3)},this.aborted=function(){return h},this.abort=function(){h=!0,r.abort(),d.meta.aborted=!0,E(e.complete)&&e.complete(d),t=""}}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,r=(e=e||{}).delimiter,n=e.newline,i=e.comments,s=e.step,a=e.preview,u=e.fastMode,l=t=void 0===e.quoteChar||null===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(l=e.escapeChar),("string"!=typeof r||-1<o.BAD_DELIMITERS.indexOf(r))&&(r=","),i===r)throw Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||-1<o.BAD_DELIMITERS.indexOf(i))&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var f=0,h=!1;this.parse=function(e,o,c){if("string"!=typeof e)throw Error("Input must be a string");var d=e.length,m=r.length,g=n.length,_=i.length,v=E(s),y=[],b=[],w=[],k=f=0;if(!e)return j();if(u||!1!==u&&-1===e.indexOf(t)){for(var O=e.split(n),C=0;C<O.length;C++){if(f+=(w=O[C]).length,C!==O.length-1)f+=n.length;else if(c)break;if(!i||w.substring(0,_)!==i){if(v){if(y=[],z(w.split(r)),F(),h)return j()}else z(w.split(r));if(a&&a<=C)return y=y.slice(0,a),j(!0)}}return j()}for(var R=e.indexOf(r,f),T=e.indexOf(n,f),S=RegExp(p(l)+p(t),"g"),M=e.indexOf(t,f);;)if(e[f]!==t){if(i&&0===w.length&&e.substring(f,f+_)===i){if(-1===T)return j();f=T+g,T=e.indexOf(n,f),R=e.indexOf(r,f)}else if(-1!==R&&(R<T||-1===T))w.push(e.substring(f,R)),f=R+m,R=e.indexOf(r,f);else{if(-1===T)break;if(w.push(e.substring(f,T)),N(T+g),v&&(F(),h))return j();if(a&&y.length>=a)return j(!0)}}else for(M=f,f++;;){if(-1===(M=e.indexOf(t,M+1)))return c||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:y.length,index:f}),x();if(M===d-1)return x(e.substring(f,M).replace(S,t));if(t!==l||e[M+1]!==l){if(t===l||0===M||e[M-1]!==l){-1!==R&&R<M+1&&(R=e.indexOf(r,M+1)),-1!==T&&T<M+1&&(T=e.indexOf(n,M+1));var D=I(-1===T?R:Math.min(R,T));if(e.substr(M+1+D,m)===r){w.push(e.substring(f,M).replace(S,t)),e[f=M+1+D+m]!==t&&(M=e.indexOf(t,f)),R=e.indexOf(r,f),T=e.indexOf(n,f);break}var A=I(T);if(e.substring(M+1+A,M+1+A+g)===n){if(w.push(e.substring(f,M).replace(S,t)),N(M+1+A+g),R=e.indexOf(r,f),M=e.indexOf(t,f),v&&(F(),h))return j();if(a&&y.length>=a)return j(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:y.length,index:f}),M++}}else M++}return x();function z(e){y.push(e),k=f}function I(t){var r=0;if(-1!==t){var n=e.substring(M+1,t);n&&""===n.trim()&&(r=n.length)}return r}function x(t){return c||(void 0===t&&(t=e.substring(f)),w.push(t),f=d,z(w),v&&F()),j()}function N(t){f=t,z(w),w=[],T=e.indexOf(n,f)}function j(e){return{data:y,errors:b,meta:{delimiter:r,linebreak:n,aborted:h,truncated:!!e,cursor:k+(o||0)}}}function F(){s(j()),y=[],b=[]}},this.abort=function(){h=!0},this.getCharIndex=function(){return f}}function g(e){var t=e.data,r=i[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){n=!0,_(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(E(r.userStep)){for(var o=0;o<t.results.data.length&&(r.userStep({data:t.results.data[o],errors:t.results.errors,meta:t.results.meta},s),!n);o++);delete t.results}else E(r.userChunk)&&(r.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!n&&_(t.workerId,t.results)}function _(e,t){var r=i[e];E(r.userComplete)&&r.userComplete(t),r.terminate(),delete i[e]}function v(){throw Error("Not implemented.")}function y(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=y(e[r]);return t}function b(e,t){return function(){e.apply(t,arguments)}}function E(e){return"function"==typeof e}return n&&(t.onmessage=function(e){var r=e.data;if(void 0===o.WORKER_ID&&r&&(o.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:o.WORKER_ID,results:o.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var n=o.parse(r.input,r.config);n&&t.postMessage({workerId:o.WORKER_ID,results:n,finished:!0})}}),(l.prototype=Object.create(u.prototype)).constructor=l,(f.prototype=Object.create(u.prototype)).constructor=f,(h.prototype=Object.create(h.prototype)).constructor=h,(c.prototype=Object.create(u.prototype)).constructor=c,o})?n.apply(t,[]):n)&&(e.exports=r)}}]);